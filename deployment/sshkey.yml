---

- hosts: all
  user: root

  vars_files:
    - env_vars/sshkey.yml
    - env_vars/pass.yml # always use last



  tasks:
  - name: Create group "{{remote_group}}"
    group: name="{{remote_group}}" state=present
    tags: user

  - name: Setup | create user "{{remote_user}}"
    user:  name="{{remote_user}}" shell=/bin/bash state=present groups="sudo,{{ remote_group }}" password="{{ remote_password }}" comment="Deploy user"
    tags: user
 
    
  - name: Setup | authorized key upload
    authorized_key: user="{{remote_user}}" key="{{ lookup('file', '~/.ssh/id_rsa.pub') }}" 
    tags: key

  - name: Setup | User can sudo without password
    lineinfile: "dest=/etc/sudoers state=present regexp='^%{{ remote_group }} ' line='%{{ remote_group }} ALL=(ALL) NOPASSWD: ALL'"
